<!DOCTYPE html>
<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 

<title>Timeline</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>

<script type="text/javascript">

// Class for simple timelines like this:
function Timeline(events) {
	this.events = events;
    
    this.borderColor = "#aaa";
    this.eventMargin = 5;
    this.eventPadding = 5;
}

Timeline.prototype = {
	// - eventDiv.left = event.time * hFactor;
	
	// create x -axis

	draw: function() {
		for (var i = 0; i != this.events.length; ++i) {
			var eventDiv = $("<div class='event' />");
			eventDiv.append(this.events[i].label);
            eventDiv.css({
                "border-left": "1px solid " + this.borderColor,
                "margin-bottom": this.eventMargin + "px",
                "padding-left": this.eventPadding + "px"
            });
			$("#timeline").append(eventDiv);
		};
	}
};

$(document).ready(function() {

	// get the earliest and latest event times    
	// would be better if possible not to iterate twice through performance.timing!
	var minTime = Number.MAX_VALUE;
	var maxTime = Number.MIN_VALUE;
	for (eventName in performance.timing) {
		var time = parseInt(performance.timing[eventName]);
		if (time > maxTime) { 
			maxTime = time;
		}
		// performance.timing events that did not occur have zero time
		// e.g. secureConnectionStart or redirectStart
		if (time !== 0 && time < minTime) { 
			minTime = time;
		}
	}
	
	console.log("minTime: " + minTime);

	var attributesByTime = {}; 
	// attributesByTime consists of arrays of performance.timing  
	// attributes (event names) keyed by time
	// -- note that there may be more than one event for each time
	var didntHappen = []; // names of possible events that did not occur
	// get the time of each attribute (event) in performance.timing
    // -- note that performance.timing properties are not enumerable in IE 9.0
    // so Object.keys() won't work
	for (eventName in performance.timing) {	
		var time = parseInt(performance.timing[eventName]); 
		// performance.timing events that did not occur have zero time
		// e.g. secureConnectionStart or redirectStart
		if (time === 0) {  
			didntHappen.push(eventName);
		} else { 
			// begin event times from zero
			var normalisedTime = time - minTime;
			// add event name to the array of event names for the current time
			if (attributesByTime[normalisedTime]) {
				attributesByTime[normalisedTime].push(eventName)
			} else {
				attributesByTime[normalisedTime] = [normalisedTime];
			}
		}
	}	
	
	console.log(attributesByTime);
	console.log(didntHappen);
 
	var timeline = new Timeline(events);
	timeline.draw();
}); // document.ready

</script>

<style type="text/css">

</style>

</head>

<body>

<div id="timeline" />

</body>

</html>