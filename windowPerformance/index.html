<!DOCTYPE html>
<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 

<title>Timeline</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>

<script type="text/javascript">

function Timeline(events) {
	this.events = events;
    
    this.borderColor = "#aaa";
    this.eventMargin = 5;
    this.eventPadding = 5;
}

Timeline.prototype = {
	// for each event in events
	// create an eventDiv:
	// - innerHTML = event.value;
	// - eventDiv.left = event.time * hFactor;
	// - eventDiv.css
	// - eventDiv.top = index * vFactor;
	
	// create x -axis

	draw: function() {
		for (var i = 0; i != this.events.length; ++i) {
			var eventDiv = $("<div class='event' />");
			eventDiv.append(this.events[i].label);
            eventDiv.css({
                "border-left": "1px solid " + this.borderColor,
                "margin-bottom": this.eventMargin + "px",
                "padding-left": this.eventPadding + "px"
            });
			$("#timeline").append(eventDiv);
		};
	}
};

$(document).ready(function() {
    // array of navigation or load events
    // each object in the array has a time property 
    // and events property: an array of event names
	var times = []; 
	var didntHappen = []; // names of navigation or load events that did not occur
	// for each attribute in performance.timing
	// create an object and add it to the events array
	var minTime = Number.MAX_VALUE;
	var maxTime = Number.MIN_VALUE;
    // performance.timing properties are not enumerable in IE 9.0 so Object.keys() won't work
	for (eventName in performance.timing) {	
		var time = parseInt(performance.timing[eventName]);
		if (time === 0) {  // events that did not occur have zero time
			didntHappen.push(eventName);
		} else {
        
        
        if (attributesByTime.hasOwnProperty(time)) { // if another attribute has the same time
			attributesByTime[time] += ", " + key; // add the name of this one after a comma
		} else {
			attributesByTime[time] = key;
		}
        
			var time = {};
			if (time > maxTime) { // work out the earliest and latest event times
				maxTime = time;
			}
			if (time < minTime) {
				minTime = time;
			}
			event["time"] = time;
			events.push(event);
		}
	})	
	
	// subtract minTime from each event time
	// so that the earliest event time is zero
	for (var i = 0; i != events.length; ++i) {
		events[i].time -= minTime;
	};
 
	// sort the events array by time
	events.sort(function(a, b){return a.time - b.time});
	var eventsSortedByTime = [];
    for 
	events.forEach(function(event){
			eventsSortedByTime.push(event.time + ": " + event.attribute);
	});
	document.body.innerHTML += eventsSortedByTime.join("<br />") + "<br />";
	document.body.innerHTML += "Total elapsed: " + (maxTime - minTime) + "<br />";
	document.body.innerHTML += "Not applicable: " + notApplicable.join(", ");


	var timeline = new Timeline(events);
	timeline.draw();
});

</script>

<style type="text/css">

</style>

</head>

<body>

<div id="timeline" />

</body>

</html>