<!DOCTYPE html>
<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 

<title>Page Visibility demo</title>

</head>

<body>

<video id="videoElement" autoplay controls >
	<source src="video/dizzy.mp4" />
	<source src="video/video.ogv" />
</video>

<script src="js/jquery-1.6.1.js"></script>
<script src="js/favicon.js"></script>

<script type="text/javascript">

var videoElement = document.getElementById("videoElement");

// if the page is hidden, pause the video
// if the page is shown, play the video
function handleVisibilityChange() {
	if (document.webkitHidden) {
		videoElement.pause();
	} else {
		videoElement.play();
	}
}

// if document doesn't support webkitHidden
if (typeof document.webkitHidden === "undefined") {
	alert("This demo requires a browser such as Google Chrome 13 that supports the Page Visibility API.");
	videoElement.play(); 
} else {
// handle page visibility change
// see https://developer.mozilla.org/en/API/PageVisibility/Page_Visibility_API
document.addEventListener("webkitvisibilitychange", 
	handleVisibilityChange, false);
}

// revert to existing favicon for site when the page is closed
// otherwise the favicon will remain as paused.png
window.addEventListener("unload", function(){
		favicon.change('/favicon.ico');
	}, false);

// when the video pauses, set the favicon
videoElement.addEventListener("pause", function(){
		favicon.change('images/paused.png');
	}, false);

// when the video plays, set the favicon
videoElement.addEventListener("play", function(){
		favicon.change('images/playing.png');
	}, false);

// set the document (tab) title from the current video time
videoElement.addEventListener("timeupdate", function(){
		document.title = "Time: " + 
			Math.floor(videoElement.currentTime);
	}, false);

</script>

</body>

</html>